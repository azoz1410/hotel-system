<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ุจุฑูุฌุฉ ุจุทุงูุฉ NFC - ููุฏู ุงูุฃุฒูุฒ</title>
    <!-- Theme System -->
    <script src="theme-switcher.js"></script>
</head>
<body>
    <div class="container">
        <div class="logo">
            <h1>๐จ ููุฏู ุงูุฃุฒูุฒ</h1>
            <p>ุจุฑูุฌุฉ ุจุทุงูุฉ NFC</p>
        </div>

        <div class="card-icon">๐ณ</div>

        <div class="passcode-display">
            <div class="passcode-label">ุงูุฑูู ุงูุณุฑู ููุบุฑูุฉ</div>
            <div class="passcode-value">1733</div>
        </div>

        <button class="write-button" id="writeButton" onclick="writeNFC()">
            โ๏ธ ูุชุงุจุฉ ุจุทุงูุฉ NFC
        </button>

        <button onclick="saveToWallet()" class="write-button">
            ๐ณ ุญูุธ ูู Wallet/Cards
        </button>

        <button onclick="downloadCard()" class="write-button">
            ๐ฅ ุชุญููู ุจุทุงูุฉ ุฑูููุฉ
        </button>

        <button onclick="window.location.href='code.html'" class="write-button">
            โฉ๏ธ ุงูุนูุฏุฉ ุฅูู ุตูุญุฉ ุงูุฑูุฒ
        </button>

        <div class="status-message" id="statusMessage"></div>

        <div class="requirements">
            <div class="requirements-title">
                ๐ฑ ุงููุชุทูุจุงุช
            </div>
            <ul>
                <li>ูุงุชู Android ูุฏุนู NFC</li>
                <li>ูุชุตูุญ Chrome ุนูู Android</li>
                <li>ุจุทุงูุฉ NFC ูุงุฑุบุฉ ุฃู ูุงุจูุฉ ูุฅุนุงุฏุฉ ุงููุชุงุจุฉ</li>
                <li>ุชูุนูู NFC ูู ุฅุนุฏุงุฏุงุช ุงููุงุชู</li>
            </ul>
        </div>

        <div class="instructions">
            <h3>๐ ุทุฑููุฉ ุงูุงุณุชุฎุฏุงู:</h3>
            <ol>
                <li>ุชุฃูุฏ ูู ุชูุนูู NFC ูู ุฅุนุฏุงุฏุงุช ูุงุชูู</li>
                <li>ุงูุชุญ ูุฐู ุงูุตูุญุฉ ูู ูุชุตูุญ Chrome ุนูู Android</li>
                <li>ุฃุญุถุฑ ุจุทุงูุฉ NFC ูุงุฑุบุฉ</li>
                <li>ุงุถุบุท ุนูู ุฒุฑ "ูุชุงุจุฉ ุงูุจุทุงูุฉ"</li>
                <li>ูุฑูุจ ุงูุจุทุงูุฉ ูู ุธูุฑ ุงููุงุชู</li>
                <li>ุงูุชุธุฑ ุฑุณุงูุฉ ุงููุฌุงุญ</li>
                <li>ุงุณุชุฎุฏู ุงูุจุทุงูุฉ ุนูู ููู TTLock</li>
            </ol>
        </div>

        <div class="warning">
            <div class="warning-title">
                โ๏ธ ุชูุจูู ููู
            </div>
            <div class="warning-content">
                <p><strong>ูุฏ ูุง ุชุนูู ูุฐู ุงูุทุฑููุฉ ูุน ููู TTLock!</strong></p>
                <p>โข ููู TTLock ูุฏ ูุชุทูุจ ุชุณุฌูู ุงูุจุทุงูุฉ ุฃููุงู ุนุจุฑ ุงูุชุทุจูู ุงูุฑุณูู</p>
                <p>โข ูุฐู ุงูุตูุญุฉ ุชูุชุจ ุงูุฑูู ุงูุณุฑู ููุต ุนุงุฏู ุนูู ุงูุจุทุงูุฉ</p>
                <p>โข ููุญุตูู ุนูู ุฃูุถู ุงููุชุงุฆุฌุ ุงุณุชุฎุฏู ุชุทุจูู TTLock ุงูุฑุณูู ูุฅุถุงูุฉ ุจุทุงูุงุช</p>
            </div>
        </div>
    </div>

    <script>
        // ุงูุชุญูู ูู ุฏุนู NFC
        if (!('NDEFReader' in window)) {
            document.getElementById('writeButton').disabled = true;
            showMessage('error', 'โ ูุชุตูุญู ูุง ูุฏุนู NFC. ุงุณุชุฎุฏู Chrome ุนูู Android.');
        }

        const passcode = '1733';
        const hotelName = 'ููุฏู ุงูุฃุฒูุฒ';

        async function writeNFC() {
            const button = document.getElementById('writeButton');

            try {
                // ุทูุจ ุฅุฐู NFC
                button.disabled = true;
                button.textContent = 'โณ ุฌุงุฑู ุงูุชุญุถูุฑ...';
                showMessage('info', '๐ฑ ูุฑูุจ ุงูุจุทุงูุฉ ูู ุธูุฑ ูุงุชูู ุงูุขู...');

                const ndef = new NDEFReader();
                
                // ูุชุงุจุฉ ุงูุจุทุงูุฉ
                await ndef.write({
                    records: [
                        {
                            recordType: "text",
                            data: `TTLock Passcode: ${passcode}`,
                            lang: "ar"
                        },
                        {
                            recordType: "text",
                            data: passcode,
                            lang: "en"
                        }
                    ]
                });

                // ูุฌุญุช ุงูุนูููุฉ
                button.textContent = 'โ ุชูุช ุงููุชุงุจุฉ ุจูุฌุงุญ!';
                showMessage('success', 'โ ุชู ูุชุงุจุฉ ุงูุจุทุงูุฉ ุจูุฌุงุญ! ููููู ุงูุขู ุงุณุชุฎุฏุงููุง ุนูู ุงูููู.');
                
                // ุฅุนุงุฏุฉ ุชุนููู ุงูุฒุฑ ุจุนุฏ 3 ุซูุงูู
                setTimeout(() => {
                    button.disabled = false;
                    button.textContent = 'โ๏ธ ูุชุงุจุฉ ุจุทุงูุฉ ุฃุฎุฑู';
                }, 3000);

            } catch (error) {
                button.disabled = false;
                button.textContent = 'โ๏ธ ูุชุงุจุฉ ุงูุจุทุงูุฉ';
                
                console.error('ุฎุทุฃ ูู ูุชุงุจุฉ NFC:', error);
                
                if (error.name === 'NotAllowedError') {
                    showMessage('error', 'โ ุชู ุฑูุถ ุฅุฐู ุงููุตูู ุฅูู NFC. ูุฑุฌู ุงูุณูุงุญ ุจุงููุตูู ูุงููุญุงููุฉ ูุฑุฉ ุฃุฎุฑู.');
                } else if (error.name === 'NotSupportedError') {
                    showMessage('error', 'โ ุฌูุงุฒู ูุง ูุฏุนู NFC ุฃู NFC ุบูุฑ ููุนูู.');
                } else if (error.name === 'AbortError') {
                    showMessage('error', 'โ ุชู ุฅูุบุงุก ุงูุนูููุฉ. ุชุฃูุฏ ูู ุชูุฑูุจ ุงูุจุทุงูุฉ.');
                } else {
                    showMessage('error', `โ ุญุฏุซ ุฎุทุฃ: ${error.message}`);
                }
            }
        }

        // ุญูุธ ูู Wallet (vCard ููุฃููููุ ูุญูุธ ูู ุฌูุงุช ุงูุงุชุตุงู ููููู ุงููุตูู ูู ูู Wallet)
        function saveToWallet() {
            // ุฅูุดุงุก vCard
            const vCard = `BEGIN:VCARD
VERSION:3.0
FN:${hotelName} - ุบุฑูุฉ 101
ORG:${hotelName}
NOTE:ุฑูุฒ ูุชุญ ุงูููู TTLock\\nุงูุฑูู ุงูุณุฑู: ${passcode}\\n\\nุทุฑููุฉ ุงูุงุณุชุฎุฏุงู:\\n1. ุงุฐูุจ ุฅูู ุงูููู\\n2. ุฃุฏุฎู ${passcode}\\n3. ุงุถุบุท # ููุชุฃููุฏ
TEL;TYPE=HOTEL:${passcode}
URL:https://github.com/azoz1410/hotel-system
END:VCARD`;

            // ุชุญููู ุฅูู Blob
            const blob = new Blob([vCard], { type: 'text/vcard' });
            const url = URL.createObjectURL(blob);
            
            // ุฅูุดุงุก ุฑุงุจุท ุชุญููู
            const link = document.createElement('a');
            link.href = url;
            link.download = `hotel-card-${passcode}.vcf`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
            
            showMessage('success', 'โ ุชู ุชุญููู ุงูุจุทุงูุฉ! ุงูุชุญ ุงูููู ูุญูุธูุง ูู ุฌูุงุช ุงูุงุชุตุงู.');
        }

        // ุชุญููู ุจุทุงูุฉ ุฑูููุฉ (ุตูุฑุฉ)
        function downloadCard() {
            // ุฅูุดุงุก canvas
            const canvas = document.createElement('canvas');
            canvas.width = 800;
            canvas.height = 500;
            const ctx = canvas.getContext('2d');

            // ุงูุฎูููุฉ
            const gradient = ctx.createLinearGradient(0, 0, 800, 500);
            gradient.addColorStop(0, '#667eea');
            gradient.addColorStop(1, '#764ba2');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, 800, 500);

            // ุงูุจุทุงูุฉ
            ctx.fillStyle = 'rgba(255, 255, 255, 0.95)';
            ctx.roundRect(50, 50, 700, 400, 30);
            ctx.fill();

            // ุงูุนููุงู
            ctx.fillStyle = '#2c3e50';
            ctx.font = 'bold 48px Cairo, Arial';
            ctx.textAlign = 'center';
            ctx.fillText('๐จ ' + hotelName, 400, 130);

            // ูุต "ุงูุฑูู ุงูุณุฑู"
            ctx.font = '32px Cairo, Arial';
            ctx.fillStyle = '#666';
            ctx.fillText('ุงูุฑูู ุงูุณุฑู ููุชุญ ุงูููู', 400, 200);

            // ุงูุฑูู ุงูุณุฑู
            ctx.font = 'bold 120px Inter, monospace';
            ctx.fillStyle = '#667eea';
            ctx.fillText(passcode, 400, 320);

            // ูุนูููุงุช ุฅุถุงููุฉ
            ctx.font = '24px Cairo, Arial';
            ctx.fillStyle = '#888';
            ctx.fillText('TTLock Smart Lock Access Code', 400, 400);

            // ุชุญููู ุฅูู ุตูุฑุฉ ูุชุญููููุง
            canvas.toBlob((blob) => {
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `hotel-card-${passcode}.png`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
                
                showMessage('success', 'โ ุชู ุชุญููู ุงูุจุทุงูุฉ ุงูุฑูููุฉ! ุงุญูุธูุง ูู ูุนุฑุถ ุงูุตูุฑ.');
            });
        }

        function showMessage(type, text) {
            const messageEl = document.getElementById('statusMessage');
            messageEl.className = `status-message ${type}`;
            messageEl.textContent = text;
            messageEl.style.display = 'block';

            if (type === 'success') {
                setTimeout(() => {
                    messageEl.style.display = 'none';
                }, 5000);
            }
        }

        // ุฏุนู roundRect ูููุชุตูุญุงุช ุงููุฏููุฉ
        if (!CanvasRenderingContext2D.prototype.roundRect) {
            CanvasRenderingContext2D.prototype.roundRect = function (x, y, width, height, radius) {
                this.beginPath();
                this.moveTo(x + radius, y);
                this.lineTo(x + width - radius, y);
                this.quadraticCurveTo(x + width, y, x + width, y + radius);
                this.lineTo(x + width, y + height - radius);
                this.quadraticCurveTo(x + width, y + height, x + width - radius, y + height);
                this.lineTo(x + radius, y + height);
                this.quadraticCurveTo(x, y + height, x, y + height - radius);
                this.lineTo(x, y + radius);
                this.quadraticCurveTo(x, y, x + radius, y);
                this.closePath();
                return this;
            };
        }
    </script>
</body>
</html>
